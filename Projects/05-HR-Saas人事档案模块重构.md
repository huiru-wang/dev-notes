---
title: 「Project」人事平台花名册档案模块重构设计与实现
category: project
tags:
  - project
publishedAt: 2023-06-10
description: 针对人事档案域的重构设计、线上流量稳定切流方案
---

# 为什么要重构？

1. 人事的档案随着历史发展，存储一直是异构的，底层有多张表，还有一部分数据是存储在外部服务。这些数据一起构成了一个员工的档案；
2. 在系统的架构分层中，没有统一的档案域的读写入口，其他模块在执行档案的读写甚至会直接操作某个表进行读写。
3. 读写入口40+，且多个入口含有不同的特殊逻辑。新人接手成本高；
4. 影响迭代效率，上层应用接入档案，还得理解底层的异构存储，选择特定表来执行读写，接入成本太高；

# 急需解决的核心问题

1. <font color="#f79646">屏蔽存储层异构</font>，上层无感知接入档案域读写；
	1. 人事档案对外提供的档案查询和写入，都只是key-value的结构，不感知底层存储；
	2. 实际底层存储是异构的，存储在不同的表中、不同的服务中；
2. <font color="#f79646">40+的流量入口</font>切换到新逻辑，如何保证逻辑的正确性，线上业务无影响？或做到影响可控，随时切换回旧逻辑；
	1. 历史遗留原因，档案的写入口很多，且不同入口含有一些特殊逻辑；
	2. 首先是要足够熟悉业务；避免重构后有业务上的错误、遗漏；
	3. 其次要有一套机制，能够做到<font color="#f79646">数据对账</font>；

# 模块分层设计

![](/images/hr-saas-roster-architecture.png)

1. 统一档案域的数据模型，所有档案的更新入口模型只有一套；
2. 隔离底层存储，增加数据路由，配置化的方式，将不同的档案字段，路由到其所在的真实存储，执行读写。

# 对账逻辑设计

![](/images/hr-saas-roster-data-check.png)
